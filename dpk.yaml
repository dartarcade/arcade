mode: project

catalog:
  resolution: workspace
  issue_tracker: https://github.com/dartarcade/arcade/issues
  repository: https://github.com/dartarcade/arcade/tree/main/DPK_PACKAGE_PATH
  environment:
    sdk: ^3.5.0

  dependencies:
    luthor: ^0.13.1
    prompts: ^2.0.0
    yaml_edit: ^2.2.2

scripts:
  example:build:
    command: |
      cd packages/arcade/example
      dart run build_runner build -d

  docker:
    command: docker compose up -d
  docker:down:
    command: docker compose down

  fix:
    command: dart fix --apply
    runInPackages:
      - packages/*
  format:
    command: dart format --set-exit-if-changed .
    runInPackages:
      - packages/*
  analyze:
    command: dart analyze --fatal-infos --fatal-warnings
    runInPackages:
      - packages/*

  ffa:
    command: |
      echo "--------------------------------"
      echo "Running fix"
      echo "--------------------------------"
      dpk run fix
      echo "--------------------------------"
      echo "Running format"
      echo "--------------------------------"
      dpk run format
      echo "--------------------------------"
      echo "Running analyze"
      echo "--------------------------------"
      dpk run analyze

  test:arcade:
    command: |
      (cd ../.. && docker compose exec redis redis-cli flushall)
      dart test -j 1
    runInPackages:
      - packages/arcade

  test:cache:
    command: dart test -j 1
    runInPackages:
      - packages/arcade_cache

  test:redis:
    command: |
      (cd ../.. && docker compose exec redis redis-cli flushall)
      dart test -j 1
    runInPackages:
      - packages/arcade_cache_redis

  test:views:
    command: dart test
    runInPackages:
      - packages/arcade_views

  test:test:
    command: dart test -j 1
    runInPackages:
      - packages/arcade_test

  test:swagger:
    command: dart test
    runInPackages:
      - packages/arcade_swagger

  todo:brc:
    command: dart run build_runner clean
    runInPackages:
      - samples/todo_api

  todo:br:
    command: dart run build_runner watch --delete-conflicting-outputs
    runInPackages:
      - samples/todo_api

  todo:docker:
    command: docker compose up
    runInPackages:
      - samples/todo_api

  todo:serve:
    command: arcade serve
    runInPackages:
      - samples/todo_api

  version:minor:
    command: dart pub bump minor
    runInPackages:
      - packages/*

  version:patch:
    command: dart pub bump patch
    runInPackages:
      - packages/*

  version:major:
    command: dart pub bump major
    runInPackages:
      - packages/*

  publish:all:
    command: dart pub publish --force
    runInPackages:
      - packages/*
